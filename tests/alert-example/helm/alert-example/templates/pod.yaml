{{- range .Values.apps }}
{{- if and .enabled (eq (lower (default "deployment" .workload)) "pod") }}
apiVersion: v1
kind: Pod
metadata:
  name: {{ .name }}-{{ randAlpha 5 | lower }}
  labels:
    app: {{ .name }}
  annotations:
    instrumentation.opentelemetry.io/inject-python: {{ $.Values.otel.injectPython | quote }}
spec:
  restartPolicy: Never
  containers:
  - name: app
    image: {{ $.Values.image.repository }}:{{ $.Values.image.tag }}
    imagePullPolicy: {{ $.Values.image.pullPolicy }}
    ports:
    - containerPort: {{ $.Values.service.targetPort }}
    env:
    - name: CONFIG_PATH
      value: /etc/{{ .name }}/config.yaml
    volumeMounts:
    - name: config
      mountPath: /etc/{{ .name }}
  volumes:
  - name: config
    configMap:
      name: {{ .name }}-config
      items:
      - key: config.yaml
        path: config.yaml
---
{{- end }}
{{- end }}


