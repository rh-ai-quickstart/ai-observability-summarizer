apiVersion: v1
kind: ConfigMap
metadata:
  name: ai-model-config-readme
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: mcp-server
    app.kubernetes.io/component: documentation
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
data:
  README.md: |
    # AI Model Configuration Management

    ## Overview

    The `ai-model-config` ConfigMap stores user-managed AI model configurations.
    This ConfigMap is **NOT managed by Helm** and persists across upgrades.

    ## How It Works

    - **Defaults**: Default models are provided via the MODEL_CONFIG environment variable
    - **Runtime**: User-added models are stored in the ai-model-config ConfigMap
    - **Persistence**: The ConfigMap is created automatically on first run if it doesn't exist
    - **Upgrades**: The ConfigMap persists across Helm upgrades

    ## Management

    ### View Current Configuration
    ```bash
    kubectl get configmap ai-model-config -n {{ .Release.Namespace }} -o yaml
    ```

    ### Reset to Defaults
    To reset configuration to defaults, delete the ConfigMap and restart the MCP server:
    ```bash
    kubectl delete configmap ai-model-config -n {{ .Release.Namespace }}
    kubectl rollout restart deployment/mcp-server -n {{ .Release.Namespace }}
    ```

    The ConfigMap will be automatically recreated from defaults on next startup.

    ### Backup Configuration
    ```bash
    kubectl get configmap ai-model-config -n {{ .Release.Namespace }} -o json > ai-model-config-backup.json
    ```

    ### Restore Configuration
    ```bash
    kubectl apply -f ai-model-config-backup.json
    ```

    ## Architecture

    The model configuration system uses a two-tier approach:

    1. **MODEL_CONFIG environment variable**: Provides default/template models
    2. **ai-model-config ConfigMap**: Runtime source of truth for model configuration

    When the MCP server starts, it:
    - Checks if ai-model-config ConfigMap exists
    - If not, creates it from MODEL_CONFIG defaults
    - Uses ConfigMap as the source of truth with 60-second cache TTL
    - Automatically reloads configuration when models are added via console plugin

    ## Adding Models

    Models can be added via:
    - OpenShift console plugin Settings page
    - MCP tool: `add_model_to_config`

    Changes take effect immediately without requiring pod restart.
